<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repartos Master Grid</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Masonry Layout Library -->
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        slate: { 850: '#1e293b' }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* --- MASONRY GRID SETUP --- */
        .masonry-grid { width: 100%; }
        
        /* 
           GRID SIZER:
           We use a 4-column system (25% base) to accommodate your request.
        */
        .grid-sizer { width: 100%; } /* Default Mobile */

        /* ITEM BASE STYLES */
        .grid-item { 
            width: 100%; 
            padding-bottom: 1.5rem; /* Vertical Gutter */
            box-sizing: border-box;
            transition: width 0.3s ease;
        }

        /* --- RESPONSIVE WIDTH LOGIC --- */

        /* Tablet (768px+): 2 Column Base */
        @media (min-width: 768px) {
            .grid-sizer { width: 50%; }
            .grid-item.w-small { width: 50%; padding-right: 1rem; }  /* 1-2 stops */
            .grid-item.w-medium { width: 100%; padding-right: 0; }   /* 3-4 stops (Full on tablet) */
            .grid-item.w-large { width: 100%; padding-right: 0; }    /* 5+ stops */
        }

        /* Desktop (1280px+): 4 Column Base (YOUR REQUEST) */
        @media (min-width: 1280px) {
            .grid-sizer { width: 25%; }
            
            /* 1-2 Stops = 25% (1 Column) */
            .grid-item.w-small { 
                width: 25%; 
                padding-right: 1.5rem; 
            } 
            
            /* 3-4 Stops = 50% (2 Columns) */
            .grid-item.w-medium { 
                width: 50%; 
                padding-right: 1.5rem; 
            } 
            
            /* 5+ Stops = 100% (4 Columns) */
            .grid-item.w-large { 
                width: 100%; 
                padding-right: 0; 
            }
        }

        /* --- INNER STOP CARD LAYOUT --- */
        /* Strict Grid for internal items */
        .inner-grid {
            display: grid;
            /* Items will be at least 180px wide, filling available space */
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.75rem;
            width: 100%;
        }

        /* Stop Card Visuals */
        .stop-ticket {
            display: flex;
            align-items: stretch;
            background-color: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            overflow: hidden;
            height: 52px; /* Fixed height for uniformity */
            box-shadow: 0 1px 2px rgba(0,0,0,0.02);
        }
        
        /* Status Colors */
        .stop-ticket.pending { background-color: #fff7ed; border-color: #ffedd5; }
        .stop-ticket.done    { background-color: #ecfdf5; border-color: #a7f3d0; }

        /* Icon Section */
        .stop-icon-box {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        /* Text Section */
        .stop-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 0.5rem;
            border-left: 1px solid rgba(0,0,0,0.05);
            min-width: 0; /* Text truncation fix */
        }

    </style>
</head>
<body class="flex h-screen overflow-hidden text-slate-900">

    <!-- Sidebar -->
    <aside class="w-16 bg-white border-r border-gray-200 hidden md:flex flex-col items-center py-4 gap-6 shrink-0 z-30">
        <button class="p-2 hover:bg-slate-100 rounded-md"><i data-lucide="menu" class="w-6 h-6 text-slate-600"></i></button>
        <div class="mt-auto pb-4">
             <button class="p-2 hover:bg-slate-100 rounded-md text-slate-400"><i data-lucide="user" class="w-6 h-6"></i></button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col min-w-0 bg-[#f4f4f5] relative">
        
        <!-- Header -->
        <header class="bg-white px-6 py-4 border-b border-gray-200 flex items-center justify-between shrink-0">
            <div>
                <h1 class="text-xl font-bold text-slate-900">Monitor de Rutas</h1>
                <p class="text-xs text-slate-500">Vista de cuadrícula dinámica</p>
            </div>
            <div class="flex gap-2">
                <button class="flex items-center gap-2 px-3 py-1.5 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-md text-sm font-medium transition-colors">
                    <i data-lucide="filter" class="w-4 h-4"></i> Filtros
                </button>
                <button class="flex items-center gap-2 px-3 py-1.5 bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-md text-sm font-medium transition-colors">
                    <i data-lucide="download" class="w-4 h-4"></i> Exportar
                </button>
            </div>
        </header>

        <!-- Status Chips -->
        <div class="px-6 py-2 bg-slate-50 border-b border-gray-200 overflow-x-auto whitespace-nowrap flex gap-3 shrink-0 scrollbar-hide">
            <span class="text-xs font-bold text-slate-400 uppercase tracking-wider py-1">Resumen:</span>
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-white border border-gray-200 rounded-full text-xs font-medium shadow-sm">
                <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Completados: 45
            </div>
            <div class="inline-flex items-center gap-2 px-3 py-1 bg-white border border-gray-200 rounded-full text-xs font-medium shadow-sm">
                <span class="w-2 h-2 rounded-full bg-orange-500"></span> Pendientes: 128
            </div>
        </div>

        <!-- MASONRY CONTAINER -->
        <div class="flex-1 overflow-y-auto p-4 md:p-6" id="scroll-wrapper">
            <div class="masonry-grid" id="masonry-grid">
                <!-- Sizer for Masonry (Defines column width) -->
                <div class="grid-sizer"></div>
                <!-- Items injected here -->
            </div>
            <div class="h-24"></div> <!-- Footer padding -->
        </div>

    </main>

    <!-- DEV BUTTON (FAB) -->
    <div class="fixed bottom-8 right-8 z-50 flex flex-col items-end gap-2 group">
        <div class="bg-slate-800 text-white text-xs py-1 px-3 rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none mb-1">
            Add Random Trip
        </div>
        <button id="add-trip-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-full shadow-xl transition-all hover:scale-105 active:scale-95 focus:outline-none ring-4 ring-indigo-600/20">
            <i data-lucide="plus" class="w-8 h-8"></i>
        </button>
    </div>

    <!-- LOGIC -->
    <script>
        lucide.createIcons();

        // --- Mock Data ---
        const lastNames = ["GARCIA", "MARTINEZ", "RODRIGUEZ", "LOPEZ", "PEREZ", "GONZALEZ"];
        const firstNames = ["JUAN", "MARIA", "CARLOS", "ANA", "LUIS", "SOFIA"];
        
        function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

        // --- Core Function: Create Trip Card ---
        function createTripCard() {
            // 1. Generate Random Stops (1 to 40)
            const stopsCount = getRandomInt(1, 40);

            // 2. Apply Sizing Logic (Strict user requirement)
            let widthClass = "";
            let sizeLabel = "";
            
            if (stopsCount <= 2) {
                widthClass = "w-small";   // 25%
                sizeLabel = "Small";
            } else if (stopsCount <= 4) {
                widthClass = "w-medium";  // 50%
                sizeLabel = "Medium";
            } else {
                widthClass = "w-large";   // 100%
                sizeLabel = "Full";
            }

            // 3. Generate Header Data
            const name = `${lastNames[getRandomInt(0,5)]}, ${firstNames[getRandomInt(0,5)]}`;
            const id = `TR-${getRandomInt(1000,9999)}`;
            
            // Randomly decide how many are "done" for visualization
            const doneCount = getRandomInt(0, stopsCount);

            // 4. Build Stops HTML
            let stopsHtml = '';
            for (let i = 0; i < stopsCount; i++) {
                const isDone = i < doneCount;
                const statusClass = isDone ? 'done' : 'pending';
                const iconColor = isDone ? 'text-emerald-600' : 'text-orange-500';
                const textColor = isDone ? 'text-emerald-800' : 'text-orange-700';
                const label = isDone ? 'ENTREGADO' : 'PENDIENTE';
                const icon = isDone ? 'check' : 'clock';

                stopsHtml += `
                    <div class="stop-ticket ${statusClass}">
                        <div class="stop-icon-box">
                            <i data-lucide="${icon}" class="${iconColor} w-5 h-5"></i>
                        </div>
                        <div class="stop-info">
                            <span class="text-[10px] font-bold text-slate-400 uppercase">STOP ${i+1}</span>
                            <div class="flex items-center gap-1">
                                <span class="text-[10px] font-bold ${textColor}">${label}</span>
                                <span class="text-[10px] text-slate-500 font-mono">10:00</span>
                            </div>
                        </div>
                    </div>
                `;
            }

            // 5. Build Container
            const div = document.createElement('div');
            div.className = `grid-item ${widthClass}`;
            
            div.innerHTML = `
                <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm flex flex-col gap-3 h-full hover:border-indigo-300 transition-colors">
                    <!-- Header -->
                    <div class="flex justify-between items-start">
                        <div class="flex flex-col">
                            <h3 class="font-bold text-slate-800 text-sm flex items-center gap-2">
                                ${name} 
                                <span class="bg-slate-100 text-slate-500 text-[10px] px-1.5 py-0.5 rounded font-mono">${id}</span>
                            </h3>
                            <div class="text-[11px] text-slate-500 mt-0.5">
                                Progreso: <span class="font-semibold text-slate-700">${doneCount}/${stopsCount}</span> • <span class="text-xs text-slate-400">Size: ${sizeLabel}</span>
                            </div>
                        </div>
                        <button class="text-slate-400 hover:text-slate-600"><i data-lucide="more-horizontal" class="w-4 h-4"></i></button>
                    </div>

                    <!-- Inner Grid (The Stops) -->
                    <div class="inner-grid">
                        ${stopsHtml}
                    </div>
                </div>
            `;
            
            return div;
        }

        document.addEventListener("DOMContentLoaded", () => {
            const grid = document.querySelector('#masonry-grid');
            
            // Init Masonry
            // columnWidth matches .grid-sizer (25%)
            const msnry = new Masonry( grid, {
                itemSelector: '.grid-item',
                columnWidth: '.grid-sizer',
                percentPosition: true,
                transitionDuration: '0.2s',
                horizontalOrder: true // Keeps left-to-right flow mostly intact
            });

            // Function to add item to layout
            function addTrip(prepend = false) {
                const card = createTripCard();
                
                if (prepend) {
                    // Prepend logic
                    grid.insertBefore(card, grid.querySelector('.grid-item')); 
                    msnry.prepended(card);
                } else {
                    // Append logic
                    grid.appendChild(card);
                    msnry.appended(card);
                }
                
                lucide.createIcons();
                msnry.layout();
            }

            // Populate Initial Data
            // We'll add 8 items to ensure screen fills
            for(let i=0; i<8; i++) addTrip();

            // Button Event
            document.getElementById('add-trip-btn').addEventListener('click', () => {
                addTrip(true);
                // Scroll to top to see new item
                document.getElementById('scroll-wrapper').scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>